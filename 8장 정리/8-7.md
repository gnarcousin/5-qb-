<h1>8.7 리베이스</h1>

> - 브랜치를 합치는 방법에는 `merge` 외에도 `rebase` 병합이 존재함
>> + 리베이스는 커밋의 **트리 구조를 재배열**하는데, 이 결과가 병합과 유사함

<h2>8.7.1 베이스</h2>

> - 브랜치는 특정 커밋을 가리키는 포인터임
> - 가리키는 특정 커밋 뿌리 `root`가 존재함 
>> - `root` = 브랜치가 파생된 기준
> - 새로운 브랜치가 파생되는 베이스 `base` = **공통 조상 커밋**이 존재

<h2>8.7.2 베이스 변경</h2>

> - `rebase` = `base` **커밋을 변경**함
>> - 커밋의 진행 모습을 단순화하기 위해서임 (여러 브랜치의 갈래를 **하나로 정리 가능**)
>> - 브랜치의 공통 조상 커밋을 **master** 브랜치의 마지막 커밋으로 변경하고,  
>>   모든 브랜치의 커밋들을 **리베이스된 커밋 이후로 재정렬함**

<h2>8.7.3 리베이스 vs 병합</h2>

> - **병합** = 두 브랜치를 서로 비교해 마지막 병합된 최종 커밋을 생성함
> - **리베이스** = 두 브랜치를 비교하지 않고 순차적으로 커밋 병합을 시도
>> - 리베이스 결과물은 병합 커밋이 없음
>> - 브랜치의 마지막을 가리키는 커밋 위치가 다름


<h6>리베이스 과정</h6>

![871](https://user-images.githubusercontent.com/107753319/201579472-7e4b8729-7179-410c-b99c-de8fd3622c20.png)

<pre>
1. 공통 조상 커밋을 찾음
2. 베이스 커밋을 변경해 두 브랜치의 커밋 위치를 변경
3. 파생된 브랜치의 diff를 임시 공간에 보관
4. 브랜치의 마지막 커밋으로 베이스 기준점 변경
5. 변경하는 기준 브랜치의 마지막 커밋(커밋6)에서 차례로 임시 공간에 저장한 diff를 하나씩 적용
6. 새로운 베이스 기준점을 기반으로 한 브랜치의 새로운 커밋들(커밋 3,4)을 마지막 커밋부터 연장해 수정 재배치함
7. 브랜치의 새로운 커밋은 모든 코드 내용이 반영됨
8. master 브랜치는 마지막 커밋을 가리키지만, A/HEAD 브랜치는 새로운 커밋(커밋 4)을 가리킴
</pre>

<h2>8.7.4 리베이스 명령어</h2>

> - 리베이스 작업은 rebase 명령어를 사용
```git
$ git rebase 브랜치
```

<h2>8.7.5 리베이스 병합</h2>

> - `rebase`는 병합 기준 브랜치가 `merge` 명령어와 반대임
> <h6>merge 명령어를 사용한 병합</h6>
> 
>![872](https://user-images.githubusercontent.com/107753319/201580273-e5c9326f-23d4-4037-8d5b-205a2e7c71c0.png)
>
> <h6>rebase 병합</h6>
> 
>![873](https://user-images.githubusercontent.com/107753319/201580303-0b2cb7e6-aa6b-41cb-a174-e0df172e2457.png)
>
> 그림과 같이 merge와 rebase는 **병합되는 브랜치 방향이 반대임**

<h2>8.7.6 리베이스 되었는지 확인</h2>

> - 베이스 커밋을 변경하는 과정에서 커밋들은 **재배치 작업을 실행함**
>> - 이 과정에서 커밋의 **해시 값이 변경**됨
>> - 커밋 위치가 변경될 때 해시 값 **중복을 방지하고 새로운 커밋 해시 값(커밋 ID) 생성**

<h2>8.7.7 리베이스 후 브랜치</h2>

> - 일반적으로 병합을 한 후 두 브랜치는 **같은 커밋 ID**를 가리킴
> - 그러나 리베이스는 커밋 위치를 재조정할 뿐 브랜치의 **HEAD 포인터까지 옮겨주지는 않음**
>> - 리베이스 한 후 병합 브랜치의 HEAD를 맞추기 위해 **리베이스된 브랜치를 병합**해야함
>>    - 이 때 병합 방식은 `Fast-Foward` 방식임
>>> - 리베이스 이후 HEAD 포인터의 위치 모양은 `Fast-Foward` 병합과 같은 형태
>> - `Fast-Foward` 병합까지 실행해 두 브랜치의 **HEAD를 일치시키는 작업**까지 해야 최종 병합을 완성하게 됨
>>    - 최종적으로 복잡한 트리 모양 구조가 아닌, **선형 구조로 브랜치를 변경**할 수 있음

<h2>8.7.8 리베이스 충돌과 해결</h2>

> - 리베이스 역시 **병합 과정에서 충돌이 발생할 수 있음**
>> - 충돌 발생 시 사용자가 직접 수동으로 코드를 변경해 해결해야 함
> - 충돌을 해결한 뒤에는 `rebase` 명령어와 `- continue` 옵션을 사용함
```git
$ git rebase - continue
```
> - 충돌 해결 이후 병합을 더 진행하고 모든 충돌을 해결하면 리베이스 작업을 종료시킴

<pre>
- skip 옵션을 통해 특정 커밋의 충돌을 제외할 수 있음
그러나 대부분 코드는 연결되어있으므로 제외하는 것을 추천하진 않음

rebase를 취소하고 싶으면 - abort 사용
<code>
$ git rebase - abort
</code>

</pre>

<h2>8.7.9 rebase 명령어로 커밋 수정</h2>

> - 마지막 커밋은 `- amend` 옵션으로 수정 가능함
> - `rebase`는 커밋을 재조정하는 것 외에도 `-i`옵션을 사용해 여러 커밋을 **한 커밋으로 묶을 수 있음**
>> - `-i` 옵션 사용시 메시지를 입력 가능한 vi 에디터가 실행됨
>> - 리베이스 메시지를 저장하면 **커밋들이 하나의 커밋으로 변경됨** ((이때 새 해시값이 부여))

<h2>8.7.10 리베이스할 때 주의점</h2>

> - 저장소를 외부에 공개했다면 **공개된 순간부터의 커밋은 리베이스를 사용하지 않는 것이 원칙임**
>> - 외부로 코드를 푸시하거나 공개하기 전, **로컬에서만 실행하는 것이 좋음**
>> - 외부로 공개된 커밋을 리베이스하면 커밋 위치와 해시 값이 변경되어 너무 **혼란스럽기 때문**
>> - 공개된 커밋 변경 시 `revert` 사용
